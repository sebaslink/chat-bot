<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Inteligente - Sistema Unificado v2.0</title>
    <meta name="version" content="2.1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            overflow: hidden; 
        }
        .header { 
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        
        .tabs { 
            display: flex; 
            margin-bottom: 30px; 
            border-bottom: 2px solid #e9ecef; 
            flex-wrap: wrap;
        }
        .tab { 
            padding: 15px 30px; 
            cursor: pointer; 
            border: none; 
            background: none; 
            font-size: 1.1em; 
            color: #6c757d; 
            border-bottom: 3px solid transparent; 
            transition: all 0.3s ease; 
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab.active { 
            color: #4facfe; 
            border-bottom-color: #4facfe; 
            background: rgba(79, 172, 254, 0.1);
        }
        .tab:hover { 
            background: rgba(79, 172, 254, 0.05); 
            color: #4facfe; 
        }
        
        .tab-content { 
            display: none; 
            padding: 30px; 
            min-height: 500px;
        }
        .tab-content.active { display: block; }
        
        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            overflow: hidden;
        }
        .chat-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .chat-header i { font-size: 1.5em; }
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .message.user {
            flex-direction: row-reverse;
        }
        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            word-wrap: break-word;
        }
        .message.bot .message-content {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 20px 20px 20px 5px;
        }
        .message.user .message-content {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 20px 20px 5px 20px;
        }
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: white;
        }
        .message.bot .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chat-input {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        .chat-input input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .chat-input input:focus {
            border-color: #4facfe;
        }
        .chat-input button {
            margin-left: 15px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s ease;
        }
        .chat-input button:hover {
            transform: translateY(-2px);
        }
        
        /* Document Upload */
        .upload-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #4facfe;
        }
        
        .upload-section:first-of-type {
            border-left-color: #51cf66;
        }
        
        .upload-section:last-of-type {
            border-left-color: #ffc107;
        }
        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .form-group label {
            font-weight: 600;
            color: #495057;
        }
        .form-group input, .form-group select, .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4facfe;
        }
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        .file-input-wrapper:hover {
            transform: translateY(-2px);
        }
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }
        .file-input-wrapper:active {
            transform: translateY(0);
        }
        .submit-btn {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Document List */
        .document-list {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .document-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        .document-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .document-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
        }
        .document-icon.pdf { background: #dc3545; }
        .document-icon.docx { background: #007bff; }
        .document-icon.txt { background: #6c757d; }
        .document-icon.jpg, .document-icon.png { background: #28a745; }
        .document-icon.url { background: #ffc107; color: #000; }
        .document-actions {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        .btn-info:hover {
            background: #138496;
        }
        
        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .stat-card p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        /* Chat Masivo Button */
        .chatmasivo-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
            border: none;
            padding: 20px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chatmasivo-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        .chatmasivo-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Knowledge Base */
        .knowledge-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .search-box input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1em;
        }
        .search-box button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
        }
        .search-results {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .search-result-item {
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        .search-result-item h4 {
            color: #4facfe;
            margin-bottom: 8px;
        }
        .search-result-item p {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        /* Users Management Styles */
        .users-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
        }
        .user-form-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .user-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .form-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }
        .form-group input, .form-group select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }
        .form-help {
            color: #6c757d;
            font-size: 0.8em;
            margin-top: 5px;
        }
        .username-container, .password-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .username-container input, .password-container input {
            flex: 1;
        }
        .generate-btn, .toggle-password-btn {
            padding: 12px 15px;
            background: #4facfe;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        .generate-btn:hover, .toggle-password-btn:hover {
            background: #3d8bfe;
            transform: translateY(-2px);
        }
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #3d8bfe 0%, #00d4fe 100%);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        .users-list-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .users-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        .search-container input {
            padding: 10px 40px 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            min-width: 250px;
        }
        .search-container i {
            position: absolute;
            right: 15px;
            color: #6c757d;
        }
        .users-list {
            max-height: 500px;
            overflow-y: auto;
        }
        .user-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .user-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .user-name {
            font-weight: 600;
            color: #495057;
            font-size: 1.1em;
        }
        .user-role {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .user-role.administrativo {
            background: #d4edda;
            color: #155724;
        }
        .user-role.programador {
            background: #d1ecf1;
            color: #0c5460;
        }
        .user-role.asesor {
            background: #fff3cd;
            color: #856404;
        }
        .user-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .user-detail {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .user-detail-label {
            font-size: 0.8em;
            color: #6c757d;
            font-weight: 600;
        }
        .user-detail-value {
            font-size: 0.9em;
            color: #495057;
            font-family: monospace;
        }
        .user-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .no-users {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        .no-users i {
            font-size: 3em;
            margin-bottom: 15px;
            color: #dee2e6;
        }
        
        /* Settings */
        .settings-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
        }
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        .setting-info h4 {
            margin-bottom: 5px;
            color: #495057;
        }
        .setting-info p {
            color: #6c757d;
            font-size: 0.9em;
        }
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .toggle-switch.active {
            background: #4facfe;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }
        .toggle-switch.active::after {
            transform: translateX(30px);
        }
        
        /* Database Styles */
        .database-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .database-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .control-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .search-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .search-controls input {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            min-width: 250px;
        }
        .search-controls select {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #3d8bfe 0%, #00d4fe 100%);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff8c00 100%);
            color: white;
        }
        .btn-warning:hover {
            background: linear-gradient(135deg, #ffb300 0%, #ff7f00 100%);
        }
        
        .db-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .db-stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #4facfe;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .db-stat-card h4 {
            font-size: 2em;
            color: #4facfe;
            margin: 0 0 10px 0;
        }
        .db-stat-card p {
            color: #6c757d;
            margin: 0;
            font-size: 0.9em;
        }
        
        .tables-section, .table-content-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .tables-section h4, .table-content-section h4 {
            color: #495057;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tables-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        .table-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .table-item:hover {
            border-color: #4facfe;
            background: #e3f2fd;
            transform: translateY(-2px);
        }
        .table-item.active {
            border-color: #4facfe;
            background: #e3f2fd;
        }
        .table-item h5 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .table-item p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .table-header h5 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .table-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: 600;
            text-transform: uppercase;
        }
        .table-badge.users {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }
        .table-description {
            font-size: 0.8em !important;
            color: #868e96 !important;
            font-style: italic;
            margin-top: 5px !important;
        }
        
        /* Estilos para la tabla de usuarios */
        .users-table-info {
            padding: 20px;
        }
        .table-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        .stat-item h4 {
            font-size: 2em;
            margin: 0 0 5px 0;
            color: #495057;
        }
        .stat-item p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }
        .users-by-role, .recent-users, .table-structure {
            margin-bottom: 30px;
        }
        .users-by-role h4, .recent-users h4, .table-structure h4 {
            color: #495057;
            margin-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        .role-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .role-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .role-stat.admin {
            background: #e3f2fd;
            border-color: #bbdefb;
        }
        .role-stat.programmer {
            background: #e8f5e8;
            border-color: #c8e6c9;
        }
        .role-stat.advisor {
            background: #fff3e0;
            border-color: #ffcc02;
        }
        .role-name {
            font-weight: 600;
            color: #495057;
            text-transform: capitalize;
        }
        .role-count {
            background: #495057;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .users-list {
            display: grid;
            gap: 10px;
        }
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .user-item.admin {
            background: #e3f2fd;
            border-color: #bbdefb;
        }
        .user-item.programmer {
            background: #e8f5e8;
            border-color: #c8e6c9;
        }
        .user-item.advisor {
            background: #fff3e0;
            border-color: #ffcc02;
        }
        .user-info h5 {
            margin: 0 0 5px 0;
            color: #495057;
        }
        .user-info p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
            text-transform: capitalize;
        }
        .user-date {
            color: #6c757d;
            font-size: 0.8em;
        }
        .columns-list {
            display: grid;
            gap: 10px;
        }
        .column-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        .column-name {
            font-weight: 600;
            color: #495057;
        }
        .column-type {
            color: #6c757d;
            font-size: 0.9em;
            font-family: monospace;
        }
        
        .table-content {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        .table-data {
            width: 100%;
            border-collapse: collapse;
        }
        .table-data th, .table-data td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        .table-data th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }
        .table-data tr:hover {
            background: #f8f9fa;
        }
        .table-data td {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        .no-data i {
            font-size: 3em;
            margin-bottom: 15px;
            color: #dee2e6;
        }

        /* Database Selector Styles */
        .database-selector {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .database-selector h4 {
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .db-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .db-tab {
            padding: 15px 25px;
            border: 2px solid #e9ecef;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1em;
            color: #6c757d;
        }
        .db-tab:hover {
            border-color: #4facfe;
            background: #e3f2fd;
            color: #4facfe;
        }
        .db-tab.active {
            border-color: #4facfe;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        /* Database Specific Info */
        .db-specific-info {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .db-info-card {
            text-align: center;
        }
        .db-info-card h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.5em;
        }
        .db-info-card p {
            color: #6c757d;
            margin-bottom: 20px;
        }
        .db-features {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .feature-tag {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        /* Success Button */
        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #40c057 0%, #37b24d 100%);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            .tab {
                text-align: center;
                border-bottom: 1px solid #e9ecef;
                border-radius: 0;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .chatmasivo-button {
                bottom: 20px;
                right: 20px;
                padding: 15px 20px;
                font-size: 1em;
            }
            .database-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .search-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .search-controls input {
                min-width: auto;
            }
            .db-stats-grid {
                grid-template-columns: 1fr;
            }
            .tables-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Bot칩n flotante para abrir Chat Masivo -->
    <button class="chatmasivo-button" onclick="abrirChatMasivo()">
        <i class="fas fa-users"></i> Abrir Chat Masivo
    </button>

    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h1><i class="fas fa-robot"></i> Chatbot Inteligente</h1>
                    <p>Sistema de chat con base de conocimientos avanzada</p>
                </div>
                <div style="text-align: right;">
                    <div id="userInfo" style="margin-bottom: 10px; font-size: 14px; opacity: 0.9;">
                        <div id="userName">Usuario</div>
                        <div id="userRole" style="font-size: 12px;">Rol</div>
                    </div>
                    <button onclick="logout()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 12px;">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesi칩n
                    </button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('chat-tab')">
                <i class="fas fa-comments"></i> Chat
            </button>
            <button class="tab" onclick="showTab('documents-tab')">
                <i class="fas fa-file-upload"></i> Documentos
            </button>
            <button class="tab" onclick="showTab('knowledge-tab')">
                <i class="fas fa-brain"></i> Base de Conocimientos
            </button>
            <button class="tab" onclick="showTab('stats-tab')">
                <i class="fas fa-chart-bar"></i> Estad칤sticas
            </button>
            <button class="tab" onclick="showTab('database-tab')">
                <i class="fas fa-database"></i> Base de Datos
            </button>
            <button class="tab" onclick="showTab('users-tab')">
                <i class="fas fa-users"></i> Gesti칩n de Usuarios
            </button>
            <button class="tab" onclick="showTab('settings-tab')">
                <i class="fas fa-cog"></i> Configuraci칩n
            </button>
        </div>

        <!-- Tab de Chat -->
        <div id="chat-tab" class="tab-content active">
            <div class="chat-container">
                <div class="chat-header">
                    <i class="fas fa-robot"></i>
                    <div>
                        <h3>Chatbot Inteligente</h3>
                        <p>Preg칰ntame cualquier cosa sobre tus documentos</p>
                    </div>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <div class="message bot">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            춰Hola! 游녦 Soy tu chatbot inteligente. Puedo ayudarte con informaci칩n basada en los documentos que hayas cargado. 쮼n qu칠 puedo ayudarte?
                        </div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chat-input" placeholder="Escribe tu pregunta aqu칤..." onkeypress="handleKeyPress(event)">
                    <button onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab de Documentos -->
        <div id="documents-tab" class="tab-content">
            <!-- Secci칩n de Archivos e Im치genes -->
            <div class="upload-section">
                <h3><i class="fas fa-file-upload"></i> Importar Archivos e Im치genes</h3>
                <form id="upload-file-form" class="upload-form">
                    <div class="form-group">
                        <label for="file-document-title">T칤tulo del Documento:</label>
                        <input type="text" id="file-document-title" placeholder="Ingresa un t칤tulo descriptivo" required>
                    </div>
                    
                    
                    <div class="form-group" id="file-input-group">
                        <label for="document-file">Archivo:</label>
                        <div class="file-input-wrapper" onclick="activateFileInput()">
                            <input type="file" id="document-file" accept="*/*" style="display: none;">
                            <span><i class="fas fa-cloud-upload-alt"></i> Seleccionar Archivo o Imagen</span>
                        </div>
                    </div>
                    
                    <div class="form-group" id="text-input-group" style="display: none;">
                        <label for="document-text">Contenido de Texto:</label>
                        <textarea id="document-text" rows="6" placeholder="Pega aqu칤 el contenido de texto..."></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-upload"></i> Cargar Archivo
                    </button>
                </form>
            </div>
            
            <!-- Secci칩n de URLs -->
            <div class="upload-section">
                <h3><i class="fas fa-link"></i> Importar desde URL</h3>
                <form id="upload-url-form" class="upload-form">
                    <div class="form-group">
                        <label for="url-document-title">T칤tulo del Documento:</label>
                        <input type="text" id="url-document-title" placeholder="Ingresa un t칤tulo descriptivo" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="document-url">URL del Sitio Web:</label>
                        <input type="url" id="document-url" placeholder="https://ejemplo.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="url-description">Descripci칩n (opcional):</label>
                        <textarea id="url-description" rows="3" placeholder="Describe brevemente el contenido de la URL..."></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-link"></i> Importar desde URL
                    </button>
                </form>
            </div>
            
            <!-- Lista de Documentos -->
            <div class="document-list" id="document-list">
                <h3><i class="fas fa-list"></i> Documentos Cargados</h3>
                <p>No hay documentos cargados a칰n.</p>
            </div>
        </div>

        <!-- Tab de Base de Conocimientos -->
        <div id="knowledge-tab" class="tab-content">
            <div class="knowledge-section">
                <h3><i class="fas fa-search"></i> Buscar en Base de Conocimientos</h3>
                <div class="search-box">
                    <input type="text" id="knowledge-search" placeholder="Buscar informaci칩n en tus documentos...">
                    <button onclick="searchKnowledge()">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
                <div class="search-results" id="search-results">
                    <p>Realiza una b칰squeda para ver resultados aqu칤.</p>
                </div>
            </div>
        </div>

        <!-- Tab de Estad칤sticas -->
        <div id="stats-tab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="total-documents">{{ stats.total_documentos }}</h3>
                    <p><i class="fas fa-file-alt"></i> Documentos Cargados</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-messages">0</h3>
                    <p><i class="fas fa-comments"></i> Mensajes Enviados</p>
                </div>
                <div class="stat-card">
                    <h3 id="knowledge-size">0</h3>
                    <p><i class="fas fa-brain"></i> Tama침o Base Conocimientos</p>
                </div>
                <div class="stat-card">
                    <h3 id="uptime">0</h3>
                    <p><i class="fas fa-clock"></i> Tiempo Activo (min)</p>
                </div>
            </div>
        </div>

        <!-- Tab de Base de Datos -->
        <div id="database-tab" class="tab-content">
            <div class="database-section">
                <h3><i class="fas fa-database"></i> Herramienta de Mantenimiento de Base de Datos</h3>
                
                <!-- Selector de Base de Datos -->
                <div class="database-selector">
                    <h4><i class="fas fa-server"></i> Seleccionar Base de Datos</h4>
                    <div class="db-tabs">
                        <button class="db-tab active" onclick="switchDatabase('chatbot')">
                            <i class="fas fa-robot"></i> Chatbot Principal
                        </button>
                        <button class="db-tab" onclick="switchDatabase('chatmasivo')">
                            <i class="fas fa-users"></i> Chat Masivo
                        </button>
                    </div>
                </div>
                
                <!-- Controles de la base de datos -->
                <div class="database-controls">
                    <div class="control-group">
                        <button class="btn btn-primary" onclick="refreshDatabase()">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                        <button class="btn btn-info" onclick="exportDatabase()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                        <button class="btn btn-warning" onclick="clearDatabase()">
                            <i class="fas fa-trash"></i> Limpiar BD
                        </button>
                        <button class="btn btn-success" onclick="backupDatabase()">
                            <i class="fas fa-save"></i> Backup
                        </button>
                    </div>
                    
                    <div class="search-controls">
                        <input type="text" id="db-search" placeholder="Buscar en la base de datos..." onkeyup="searchDatabase()">
                        <select id="db-table-filter" onchange="filterByTable()">
                            <option value="">Todas las tablas</option>
                        </select>
                    </div>
                </div>
                
                <!-- Estad칤sticas de la base de datos -->
                <div class="db-stats-grid">
                    <div class="db-stat-card">
                        <h4 id="db-total-records">-</h4>
                        <p>Total de Registros</p>
                    </div>
                    <div class="db-stat-card">
                        <h4 id="db-total-tables">-</h4>
                        <p>Tablas</p>
                    </div>
                    <div class="db-stat-card">
                        <h4 id="db-size">-</h4>
                        <p>Tama침o (MB)</p>
                    </div>
                    <div class="db-stat-card">
                        <h4 id="db-last-update">-</h4>
                        <p>칔ltima Actualizaci칩n</p>
                    </div>
                </div>
                
                <!-- Informaci칩n espec칤fica de cada base de datos -->
                <div class="db-specific-info" id="db-specific-info">
                    <div class="db-info-card">
                        <h4 id="db-name">Base de Datos del Chatbot</h4>
                        <p id="db-description">Contiene documentos, conversaciones y configuraciones del chatbot principal</p>
                        <div class="db-features">
                            <span class="feature-tag">Documentos</span>
                            <span class="feature-tag">Conversaciones</span>
                            <span class="feature-tag">Configuraciones</span>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de tablas -->
                <div class="tables-section">
                    <h4><i class="fas fa-table"></i> Tablas de la Base de Datos</h4>
                    <div class="tables-list" id="tables-list">
                        <p><i class="fas fa-spinner fa-spin"></i> Cargando tablas...</p>
                    </div>
                </div>
                
                <!-- Contenido de la tabla seleccionada -->
                <div class="table-content-section">
                    <h4><i class="fas fa-list"></i> Contenido de la Tabla</h4>
                    <div class="table-content" id="table-content">
                        <p>Selecciona una tabla para ver su contenido</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab de Gesti칩n de Usuarios -->
        <div id="users-tab" class="tab-content">
            <div class="users-section">
                <h3><i class="fas fa-users"></i> Gesti칩n de Usuarios</h3>
                
                <!-- Formulario de Creaci칩n de Usuario -->
                <div class="user-form-section">
                    <h4><i class="fas fa-user-plus"></i> Crear Nuevo Usuario</h4>
                    <form id="create-user-form" class="user-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="user-name">Nombres:</label>
                                <input type="text" id="user-name" name="name" required placeholder="Ingresa los nombres">
                            </div>
                            <div class="form-group">
                                <label for="user-lastname">Apellidos:</label>
                                <input type="text" id="user-lastname" name="lastname" required placeholder="Ingresa los apellidos">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="user-dni">DNI (8 d칤gitos):</label>
                                <input type="text" id="user-dni" name="dni" required placeholder="12345678" maxlength="8" pattern="[0-9]{8}">
                                <small class="form-help">Debe contener exactamente 8 d칤gitos</small>
                            </div>
                            <div class="form-group">
                                <label for="user-role">Cargo:</label>
                                <select id="user-role" name="role" required>
                                    <option value="">Selecciona un cargo</option>
                                    <option value="administrativo">Administrativo (Chatbot + Chat Masivo)</option>
                                    <option value="programador">Programador (Chatbot + Chat Masivo)</option>
                                    <option value="asesor">Asesor (Solo Chat Masivo)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="generated-username">Nombre de Usuario:</label>
                                <div class="username-container">
                                    <input type="text" id="generated-username" name="username" readonly>
                                    <button type="button" onclick="generateUsername()" class="generate-btn">
                                        <i class="fas fa-sync"></i> Generar
                                    </button>
                                </div>
                                <small class="form-help">Formato: UC + 5 n칰meros aleatorios</small>
                            </div>
                            <div class="form-group">
                                <label for="generated-password">Contrase침a:</label>
                                <div class="password-container">
                                    <input type="text" id="generated-password" name="password" readonly>
                                    <button type="button" onclick="togglePasswordVisibility()" class="toggle-password-btn">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <small class="form-help">칔ltimos 4 d칤gitos del DNI</small>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> Crear Usuario
                            </button>
                            <button type="button" onclick="clearUserForm()" class="btn btn-secondary">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Lista de Usuarios -->
                <div class="users-list-section">
                    <h4><i class="fas fa-list"></i> Usuarios Registrados</h4>
                    <div class="users-controls">
                        <button onclick="loadUsers()" class="btn btn-info">
                            <i class="fas fa-refresh"></i> Actualizar Lista
                        </button>
                        <div class="search-container">
                            <input type="text" id="user-search" placeholder="Buscar usuario..." onkeyup="searchUsers()">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <div id="users-list" class="users-list">
                        <!-- Los usuarios se cargar치n aqu칤 din치micamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab de Configuraci칩n -->
        <div id="settings-tab" class="tab-content">
            <div class="settings-section">
                <h3><i class="fas fa-cog"></i> Configuraci칩n del Sistema</h3>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Modo Debug</h4>
                        <p>Activar logs detallados para desarrollo</p>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this, 'debug')"></div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Auto-respuesta</h4>
                        <p>Responder autom치ticamente cuando no hay documentos</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this, 'auto_response')"></div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Notificaciones</h4>
                        <p>Mostrar notificaciones del sistema</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this, 'notifications')"></div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        let messageCount = 0;
        let startTime = Date.now();
        let currentDatabase = 'chatbot'; // 'chatbot' o 'chatmasivo'
        let settings = {
            debug: false,
            auto_response: true,
            notifications: true
        };

        // Mostrar tab activo
        function showTab(tabId) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            // Cargar contenido espec칤fico del tab
            if (tabId === 'stats-tab') {
                loadStatistics();
            } else if (tabId === 'documents-tab') {
                loadDocuments();
            } else if (tabId === 'database-tab') {
                loadDatabaseInfo();
            }
        }

        // Manejar env칤o de mensajes
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Agregar mensaje del usuario
            addMessage(message, 'user');
            input.value = '';
            
            // Simular respuesta del chatbot
            setTimeout(() => {
                const response = generateResponse(message);
                addMessage(response, 'bot');
                messageCount++;
                updateStats();
            }, 1000);
        }

        // Manejar tecla Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Agregar mensaje al chat
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = sender === 'bot' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll al final
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Generar respuesta del chatbot
        function generateResponse(message) {
            const responses = [
                "Interesante pregunta. Bas치ndome en los documentos cargados, puedo ayudarte con esa informaci칩n.",
                "Excelente consulta. D칠jame buscar en la base de conocimientos para darte una respuesta precisa.",
                "Entiendo tu pregunta. Seg칰n la informaci칩n disponible, te puedo proporcionar los siguientes detalles:",
                "Muy buena pregunta. He encontrado informaci칩n relevante en los documentos que pueden ayudarte:",
                "Perfecto, esa es una consulta importante. Bas치ndome en los datos disponibles, aqu칤 tienes la informaci칩n:"
            ];
            
            return responses[Math.floor(Math.random() * responses.length)] + " " + message;
        }


        // Manejar env칤o de formulario de archivos
        document.getElementById('upload-file-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('file-document-title').value;
            const submitBtn = this.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            
            // Mostrar estado de carga
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
            submitBtn.disabled = true;
            
            // Preparar datos para archivo
            const fileInput = document.getElementById('document-file');
            if (!fileInput.files[0]) {
                alert('Por favor selecciona un archivo');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                return;
            }
            
            const formData = new FormData();
            formData.append('title', title);
            formData.append('type', 'file'); // Tipo fijo para archivos
            formData.append('file', fileInput.files[0]);
            
            const requestData = formData;
            const contentType = null; // Para FormData no se especifica Content-Type
            
            // Configurar headers
            const headers = {};
            if (contentType) {
                headers['Content-Type'] = contentType;
            }
            
            // Enviar datos al servidor
            fetch('/upload_document', {
                method: 'POST',
                headers: headers,
                body: requestData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message);
                    
                    // Limpiar formulario
                    this.reset();
                    document.getElementById('file-input-group').style.display = 'block';
                    document.getElementById('text-input-group').style.display = 'none';
                    
                    // Recargar lista de documentos
                    loadDocuments();
                    updateStats();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error de conexi칩n: ' + error);
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });

        // Manejar env칤o de formulario de URLs
        document.getElementById('upload-url-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('url-document-title').value;
            const url = document.getElementById('document-url').value;
            const description = document.getElementById('url-description').value;
            const submitBtn = this.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            
            if (!url) {
                alert('Por favor ingresa una URL v치lida');
                return;
            }
            
            // Mostrar estado de carga
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Importando...';
            submitBtn.disabled = true;
            
            // Preparar datos
            const requestData = JSON.stringify({
                title: title,
                type: 'url',
                url: url,
                description: description
            });
            
            // Enviar datos al servidor
            fetch('/upload_document', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: requestData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message);
                    
                    // Limpiar formulario
                    this.reset();
                    
                    // Recargar lista de documentos
                    loadDocuments();
                    updateStats();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error de conexi칩n: ' + error);
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });

        // Cargar lista de documentos
        function loadDocuments() {
            const documentList = document.getElementById('document-list');
            documentList.innerHTML = '<h3><i class="fas fa-list"></i> Documentos Cargados</h3><p><i class="fas fa-spinner fa-spin"></i> Cargando documentos...</p>';
            
            fetch('/api/documents')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.documents.length === 0) {
                        documentList.innerHTML = `
                            <h3><i class="fas fa-list"></i> Documentos Cargados</h3>
                            <p>No hay documentos cargados a칰n.</p>
                        `;
                    } else {
                        let html = '<h3><i class="fas fa-list"></i> Documentos Cargados</h3>';
                        data.documents.forEach(doc => {
                            const iconClass = getDocumentIconClass(doc.source);
                            const icon = getDocumentIcon(doc.source);
                            html += `
                                <div class="document-item">
                                    <div class="document-info">
                                        <div class="document-icon ${iconClass}">${icon}</div>
                                        <div>
                                            <h4>${doc.title}</h4>
                                            <p>${doc.source.toUpperCase()} - ${doc.date_added}</p>
                                            <small>${doc.content_preview}</small>
                                        </div>
                                    </div>
                                    <div class="document-actions">
                                        <button class="btn btn-info" onclick="viewDocument('${doc.id}')">
                                            <i class="fas fa-eye"></i> Ver
                                        </button>
                                        <button class="btn btn-danger" onclick="deleteDocument('${doc.id}')">
                                            <i class="fas fa-trash"></i> Eliminar
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        documentList.innerHTML = html;
                    }
                } else {
                    documentList.innerHTML = `
                        <h3><i class="fas fa-list"></i> Documentos Cargados</h3>
                        <p>Error cargando documentos: ${data.message}</p>
                    `;
                }
            })
            .catch(error => {
                documentList.innerHTML = `
                    <h3><i class="fas fa-list"></i> Documentos Cargados</h3>
                    <p>Error de conexi칩n: ${error}</p>
                `;
            });
        }

        // Obtener clase de icono seg칰n el tipo de documento
        function getDocumentIconClass(source) {
            switch(source) {
                case 'pdf': return 'pdf';
                case 'docx': return 'docx';
                case 'txt': return 'txt';
                case 'url': return 'url';
                case 'text': return 'txt';
                default: return 'txt';
            }
        }

        // Obtener icono seg칰n el tipo de documento
        function getDocumentIcon(source) {
            switch(source) {
                case 'pdf': return '<i class="fas fa-file-pdf"></i>';
                case 'docx': return '<i class="fas fa-file-word"></i>';
                case 'txt': return '<i class="fas fa-file-alt"></i>';
                case 'url': return '<i class="fas fa-link"></i>';
                case 'text': return '<i class="fas fa-file-text"></i>';
                default: return '<i class="fas fa-file"></i>';
            }
        }

        // Buscar en base de conocimientos
        function searchKnowledge() {
            const query = document.getElementById('knowledge-search').value.trim();
            if (!query) return;
            
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Buscando...</p>';
            
            // Simular b칰squeda
            setTimeout(() => {
                resultsContainer.innerHTML = `
                    <div class="search-result-item">
                        <h4>Resultado 1: ${query}</h4>
                        <p>Informaci칩n relevante encontrada en el documento "Manual de Usuario.pdf" que puede responder a tu consulta.</p>
                    </div>
                    <div class="search-result-item">
                        <h4>Resultado 2: ${query}</h4>
                        <p>Datos adicionales disponibles en "Pol칤ticas de Empresa.docx" relacionados con tu b칰squeda.</p>
                    </div>
                `;
            }, 1500);
        }

        // Cargar estad칤sticas
        function loadStatistics() {
            updateStats();
        }

        // Actualizar estad칤sticas
        function updateStats() {
            document.getElementById('total-messages').textContent = messageCount;
            
            const uptime = Math.floor((Date.now() - startTime) / 60000);
            document.getElementById('uptime').textContent = uptime;
            
            // Obtener estad칤sticas del servidor
            fetch('/api/estadisticas')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('total-documents').textContent = data.total_documentos;
                    document.getElementById('knowledge-size').textContent = data.tama침o_base_conocimientos || '0 MB';
                }
            })
            .catch(error => {
                console.error('Error cargando estad칤sticas:', error);
            });
        }

        // Abrir Chat Masivo
        function abrirChatMasivo() {
            // Mostrar mensaje de carga
            const button = document.querySelector('.chatmasivo-button');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Abriendo...';
            button.disabled = true;
            
            // Llamar al endpoint para abrir chat masivo
            fetch('/abrir_chatmasivo')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Mostrar mensaje de 칠xito
                    button.innerHTML = '<i class="fas fa-check"></i> 춰Abierto!';
                    button.style.background = 'linear-gradient(135deg, #51cf66 0%, #40c057 100%)';
                    
                    // Abrir chat masivo en nueva pesta침a
                    window.open('http://localhost:5001', '_blank');
                    
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.background = 'linear-gradient(135deg, #51cf66 0%, #40c057 100%)';
                        button.disabled = false;
                    }, 2000);
                } else {
                    alert('Error: ' + data.message);
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            })
            .catch(error => {
                alert('Error de conexi칩n: ' + error);
                button.innerHTML = originalText;
                button.disabled = false;
            });
        }

        // Toggle de configuraciones
        function toggleSetting(element, setting) {
            element.classList.toggle('active');
            settings[setting] = element.classList.contains('active');
            
            // Mostrar notificaci칩n si est치 habilitada
            if (settings.notifications) {
                const status = settings[setting] ? 'activado' : 'desactivado';
                showNotification(`Configuraci칩n ${setting} ${status}`);
            }
        }

        // Mostrar notificaci칩n
        function showNotification(message) {
            // Crear elemento de notificaci칩n
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1001;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            // Agregar al DOM
            document.body.appendChild(notification);
            
            // Remover despu칠s de 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Funciones de documentos
        function viewDocument(documentId) {
            // Buscar el documento en la lista actual
            fetch('/api/documents')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const doc = data.documents.find(d => d.id === documentId);
                    if (doc) {
                        // Mostrar contenido en un modal o ventana
                        const content = doc.content_preview;
                        alert(`Documento: ${doc.title}\n\nContenido:\n${content}`);
                    } else {
                        showNotification('Documento no encontrado');
                    }
                }
            })
            .catch(error => {
                showNotification('Error al cargar documento: ' + error);
            });
        }

        function deleteDocument(documentId) {
            if (confirm('쮼st치s seguro de que quieres eliminar este documento?')) {
                fetch(`/api/delete_document/${documentId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(data.message);
                        loadDocuments(); // Recargar lista
                        updateStats(); // Actualizar estad칤sticas
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('Error de conexi칩n: ' + error);
                });
            }
        }

        // Funci칩n para mostrar la tabla de usuarios
        function displayUsersTable(tableInfo) {
            const tableContent = document.getElementById('table-content');
            
            let html = `
                <div class="users-table-info">
                    <div class="table-stats">
                        <div class="stat-item">
                            <h4>${tableInfo.total_records}</h4>
                            <p>Total de Usuarios</p>
                        </div>
                        <div class="stat-item">
                            <h4>${Object.keys(tableInfo.users_by_role).length}</h4>
                            <p>Roles Diferentes</p>
                        </div>
                    </div>
                    
                    <div class="users-by-role">
                        <h4>Usuarios por Rol</h4>
                        <div class="role-stats">
            `;
            
            Object.entries(tableInfo.users_by_role).forEach(([role, count]) => {
                const roleClass = role === 'administrativo' ? 'admin' : role === 'programador' ? 'programmer' : 'advisor';
                html += `
                    <div class="role-stat ${roleClass}">
                        <span class="role-name">${role}</span>
                        <span class="role-count">${count}</span>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                    
                    <div class="recent-users">
                        <h4>Usuarios Recientes</h4>
                        <div class="users-list">
            `;
            
            tableInfo.recent_users.forEach(user => {
                const roleClass = user.role === 'administrativo' ? 'admin' : user.role === 'programador' ? 'programmer' : 'advisor';
                html += `
                    <div class="user-item ${roleClass}">
                        <div class="user-info">
                            <h5>${user.name} ${user.lastname}</h5>
                            <p>${user.role}</p>
                        </div>
                        <div class="user-date">
                            ${new Date(user.created_at).toLocaleDateString()}
                        </div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                    
                    <div class="table-structure">
                        <h4>Estructura de la Tabla</h4>
                        <div class="columns-list">
            `;
            
            tableInfo.columns.forEach(column => {
                const pk = column.pk ? ' (PK)' : '';
                const notnull = column.notnull ? ' NOT NULL' : '';
                html += `
                    <div class="column-item">
                        <span class="column-name">${column.name}</span>
                        <span class="column-type">${column.type}${pk}${notnull}</span>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            tableContent.innerHTML = html;
        }

        // Funciones de Base de Datos
        function loadDatabaseInfo() {
            loadDatabaseStats();
            loadDatabaseTables();
            updateDatabaseInfo();
        }

        // Cambiar entre bases de datos
        function switchDatabase(dbType) {
            currentDatabase = dbType;
            
            // Actualizar pesta침as activas
            document.querySelectorAll('.db-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Actualizar informaci칩n espec칤fica
            updateDatabaseInfo();
            
            // Recargar datos
            loadDatabaseInfo();
        }

        // Actualizar informaci칩n espec칤fica de la base de datos
        function updateDatabaseInfo() {
            const dbName = document.getElementById('db-name');
            const dbDescription = document.getElementById('db-description');
            const dbFeatures = document.querySelector('.db-features');
            
            if (currentDatabase === 'chatbot') {
                dbName.textContent = 'Base de Datos del Chatbot';
                dbDescription.textContent = 'Contiene documentos, conversaciones y configuraciones del chatbot principal';
                dbFeatures.innerHTML = `
                    <span class="feature-tag">Documentos</span>
                    <span class="feature-tag">Conversaciones</span>
                    <span class="feature-tag">Configuraciones</span>
                `;
            } else if (currentDatabase === 'chatmasivo') {
                dbName.textContent = 'Base de Datos del Chat Masivo';
                dbDescription.textContent = 'Contiene contactos, grupos, mensajes y plantillas del sistema de chat masivo';
                dbFeatures.innerHTML = `
                    <span class="feature-tag">Contactos</span>
                    <span class="feature-tag">Grupos</span>
                    <span class="feature-tag">Mensajes</span>
                    <span class="feature-tag">Plantillas</span>
                `;
            }
        }

        function loadDatabaseStats() {
            const endpoint = currentDatabase === 'chatbot' ? '/api/database/stats' : '/api/chatmasivo/database/stats';
            
            fetch(endpoint, {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('db-total-records').textContent = data.total_records || '0';
                    document.getElementById('db-total-tables').textContent = data.total_tables || '0';
                    document.getElementById('db-size').textContent = data.size_mb || '0';
                    document.getElementById('db-last-update').textContent = data.last_update || 'N/A';
                } else {
                    console.error('Error cargando estad칤sticas de BD:', data.message);
                    document.getElementById('tables-list').innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error de conexi칩n: ' + data.message + '</p></div>';
                }
            })
            .catch(error => {
                console.error('Error de conexi칩n:', error);
                document.getElementById('tables-list').innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error de conexi칩n: TypeError: Failed to fetch</p></div>';
            });
        }

        function loadDatabaseTables() {
            const tablesList = document.getElementById('tables-list');
            const tableFilter = document.getElementById('db-table-filter');
            tablesList.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Cargando tablas...</p>';
            
            const endpoint = currentDatabase === 'chatbot' ? '/api/database/tables' : '/api/chatmasivo/database/tables';
            
            fetch(endpoint, {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.tables.length === 0) {
                        tablesList.innerHTML = '<div class="no-data"><i class="fas fa-database"></i><p>No hay tablas en la base de datos</p></div>';
                        tableFilter.innerHTML = '<option value="">Todas las tablas</option>';
                    } else {
                        let html = '';
                        let filterOptions = '<option value="">Todas las tablas</option>';
                        
                        data.tables.forEach(table => {
                            const icon = table.name === 'users' ? 'fas fa-users' : 'fas fa-table';
                            const badge = table.name === 'users' ? '<span class="table-badge users">Usuarios</span>' : '';
                            
                            html += `
                                <div class="table-item" onclick="selectTable('${table.name}')">
                                    <div class="table-header">
                                        <h5><i class="${icon}"></i> ${table.name}</h5>
                                        ${badge}
                                    </div>
                                    <p>${table.records} registros</p>
                                    ${table.name === 'users' ? '<p class="table-description">Gesti칩n de usuarios del sistema</p>' : ''}
                                </div>
                            `;
                            filterOptions += `<option value="${table.name}">${table.name}</option>`;
                        });
                        
                        // Agregar tabla de usuarios si no existe
                        if (!data.tables.some(table => table.name === 'users')) {
                            fetch('/api/database/users-table', {
                                credentials: 'include'
                            })
                            .then(response => response.json())
                            .then(usersData => {
                                if (usersData.success) {
                                    const usersTable = `
                                        <div class="table-item" onclick="selectTable('users')">
                                            <div class="table-header">
                                                <h5><i class="fas fa-users"></i> users</h5>
                                                <span class="table-badge users">Usuarios</span>
                                            </div>
                                            <p>${usersData.table_info.total_records} registros</p>
                                            <p class="table-description">Gesti칩n de usuarios del sistema</p>
                                        </div>
                                    `;
                                    tablesList.innerHTML += usersTable;
                                    tableFilter.innerHTML += '<option value="users">users</option>';
                                }
                            })
                            .catch(error => console.error('Error cargando tabla de usuarios:', error));
                        }
                        
                        tablesList.innerHTML = html;
                        tableFilter.innerHTML = filterOptions;
                    }
                } else {
                    tablesList.innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error: ' + data.message + '</p></div>';
                }
            })
            .catch(error => {
                tablesList.innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error de conexi칩n: ' + error + '</p></div>';
            });
        }

        function selectTable(tableName) {
            // Remover selecci칩n anterior
            document.querySelectorAll('.table-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Seleccionar tabla actual
            event.target.closest('.table-item').classList.add('active');
            
            // Cargar contenido de la tabla
            loadTableContent(tableName);
        }

        function loadTableContent(tableName) {
            const tableContent = document.getElementById('table-content');
            tableContent.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Cargando contenido...</p>';
            
            // Si es la tabla de usuarios, usar endpoint especial
            if (tableName === 'users') {
                fetch('/api/database/users-table', {
                    credentials: 'include'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayUsersTable(data.table_info);
                    } else {
                        tableContent.innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error: ' + data.message + '</p></div>';
                    }
                })
                .catch(error => {
                    tableContent.innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error de conexi칩n: ' + error + '</p></div>';
                });
                return;
            }
            
            const endpoint = currentDatabase === 'chatbot' ? 
                `/api/database/table/${tableName}` : 
                `/api/chatmasivo/database/table/${tableName}`;
            
            fetch(endpoint, {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.records.length === 0) {
                        tableContent.innerHTML = '<div class="no-data"><i class="fas fa-table"></i><p>La tabla est치 vac칤a</p></div>';
                    } else {
                        let html = '<table class="table-data"><thead><tr>';
                        
                        // Crear encabezados
                        if (data.records.length > 0) {
                            Object.keys(data.records[0]).forEach(key => {
                                html += `<th>${key}</th>`;
                            });
                        }
                        html += '</tr></thead><tbody>';
                        
                        // Crear filas
                        data.records.forEach(record => {
                            html += '<tr>';
                            Object.values(record).forEach(value => {
                                const displayValue = value === null ? 'NULL' : 
                                                   typeof value === 'string' && value.length > 100 ? 
                                                   value.substring(0, 100) + '...' : value;
                                html += `<td title="${value}">${displayValue}</td>`;
                            });
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table>';
                        tableContent.innerHTML = html;
                    }
                } else {
                    tableContent.innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error: ' + data.message + '</p></div>';
                }
            })
            .catch(error => {
                tableContent.innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error de conexi칩n: ' + error + '</p></div>';
            });
        }

        function refreshDatabase() {
            loadDatabaseInfo();
            showNotification('Base de datos actualizada');
        }

        function exportDatabase() {
            const endpoint = currentDatabase === 'chatbot' ? '/api/database/export' : '/api/chatmasivo/database/export';
            
            fetch(endpoint)
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentDatabase}_database_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showNotification(`Base de datos ${currentDatabase} exportada`);
            })
            .catch(error => {
                alert('Error exportando base de datos: ' + error);
            });
        }

        function backupDatabase() {
            const endpoint = currentDatabase === 'chatbot' ? '/api/database/backup' : '/api/chatmasivo/database/backup';
            
            fetch(endpoint, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`Backup de ${currentDatabase} creado exitosamente`);
                } else {
                    alert('Error creando backup: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error de conexi칩n: ' + error);
            });
        }

        function clearDatabase() {
            const dbName = currentDatabase === 'chatbot' ? 'Chatbot Principal' : 'Chat Masivo';
            if (confirm(`쮼st치s seguro de que quieres limpiar toda la base de datos de ${dbName}? Esta acci칩n no se puede deshacer.`)) {
                const endpoint = currentDatabase === 'chatbot' ? '/api/database/clear' : '/api/chatmasivo/database/clear';
                
                fetch(endpoint, {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(`Base de datos ${currentDatabase} limpiada`);
                        loadDatabaseInfo();
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('Error de conexi칩n: ' + error);
                });
            }
        }

        function searchDatabase() {
            const query = document.getElementById('db-search').value.trim();
            if (!query) return;
            
            const endpoint = currentDatabase === 'chatbot' ? 
                `/api/database/search?q=${encodeURIComponent(query)}` : 
                `/api/chatmasivo/database/search?q=${encodeURIComponent(query)}`;
            
            fetch(endpoint)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Mostrar resultados en la tabla de contenido
                    const tableContent = document.getElementById('table-content');
                    if (data.results.length === 0) {
                        tableContent.innerHTML = '<div class="no-data"><i class="fas fa-search"></i><p>No se encontraron resultados</p></div>';
                    } else {
                        // Crear tabla con resultados
                        let html = '<table class="table-data"><thead><tr>';
                        if (data.results.length > 0) {
                            Object.keys(data.results[0]).forEach(key => {
                                html += `<th>${key}</th>`;
                            });
                        }
                        html += '</tr></thead><tbody>';
                        
                        data.results.forEach(record => {
                            html += '<tr>';
                            Object.values(record).forEach(value => {
                                const displayValue = value === null ? 'NULL' : 
                                                   typeof value === 'string' && value.length > 100 ? 
                                                   value.substring(0, 100) + '...' : value;
                                html += `<td title="${value}">${displayValue}</td>`;
                            });
                            html += '</tr>';
                        });
                        html += '</tbody></table>';
                        tableContent.innerHTML = html;
                    }
                } else {
                    showNotification('Error en b칰squeda: ' + data.message);
                }
            })
            .catch(error => {
                showNotification('Error de conexi칩n: ' + error);
            });
        }

        function filterByTable() {
            const tableName = document.getElementById('db-table-filter').value;
            if (tableName) {
                selectTable(tableName);
            } else {
                document.getElementById('table-content').innerHTML = '<p>Selecciona una tabla para ver su contenido</p>';
            }
        }

        // Funci칩n para activar el selector de archivos
        function activateFileInput() {
            console.log('=== activateFileInput() EJECUTADA ===');
            const fileInput = document.getElementById('document-file');
            console.log('File input encontrado:', !!fileInput);
            
            if (fileInput) {
                // Acepta todos los tipos de archivos e im치genes
                fileInput.accept = '*/*';
                console.log('Accept configurado para todos los archivos:', fileInput.accept);
                fileInput.click();
                console.log('File input click ejecutado');
            } else {
                console.error('File input no encontrado');
                alert('Error: No se pudo encontrar el selector de archivos');
            }
            console.log('=== FIN activateFileInput() ===');
        }

        // ==================== FUNCIONES DE GESTI칍N DE USUARIOS ====================
        
        // Generar nombre de usuario con formato UC + 5 n칰meros aleatorios
        function generateUsername() {
            const randomNumbers = Math.floor(10000 + Math.random() * 90000);
            const username = 'UC' + randomNumbers;
            document.getElementById('generated-username').value = username;
        }
        
        // Generar contrase침a basada en los 칰ltimos 4 d칤gitos del DNI
        function generatePassword() {
            const dni = document.getElementById('user-dni').value;
            if (dni && dni.length === 8) {
                const password = dni.slice(-4);
                document.getElementById('generated-password').value = password;
            } else {
                document.getElementById('generated-password').value = '';
            }
        }
        
        // Alternar visibilidad de contrase침a
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('generated-password');
            const toggleBtn = document.querySelector('.toggle-password-btn i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleBtn.className = 'fas fa-eye';
            }
        }
        
        // Limpiar formulario de usuario
        function clearUserForm() {
            document.getElementById('create-user-form').reset();
            document.getElementById('generated-username').value = '';
            document.getElementById('generated-password').value = '';
        }
        
        // Validar DNI (8 d칤gitos)
        function validateDNI(dni) {
            return /^[0-9]{8}$/.test(dni);
        }
        
        // Crear usuario
        async function createUser(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const userData = {
                name: formData.get('name'),
                lastname: formData.get('lastname'),
                dni: formData.get('dni'),
                role: formData.get('role'),
                username: formData.get('username'),
                password: formData.get('password')
            };
            
            // Validaciones
            if (!userData.name || !userData.lastname) {
                alert('Por favor ingresa nombres y apellidos');
                return;
            }
            
            if (!validateDNI(userData.dni)) {
                alert('El DNI debe contener exactamente 8 d칤gitos');
                return;
            }
            
            if (!userData.role) {
                alert('Por favor selecciona un cargo');
                return;
            }
            
            if (!userData.username) {
                alert('Por favor genera un nombre de usuario');
                return;
            }
            
            try {
                const response = await fetch('/api/users/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Usuario creado exitosamente');
                    clearUserForm();
                    loadUsers();
                } else {
                    alert('Error al crear usuario: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al crear usuario');
            }
        }
        
        // Cargar lista de usuarios
        async function loadUsers() {
            try {
                const response = await fetch('/api/users/list', {
                    credentials: 'include'
                });
                const result = await response.json();
                
                const usersList = document.getElementById('users-list');
                
                if (result.success && result.users.length > 0) {
                    usersList.innerHTML = result.users.map(user => `
                        <div class="user-item">
                            <div class="user-header">
                                <div class="user-name">${user.name} ${user.lastname}</div>
                                <div class="user-role ${user.role}">${user.role === 'administrativo' ? 'Administrativo' : user.role === 'programador' ? 'Programador' : 'Asesor'}</div>
                            </div>
                            <div class="user-details">
                                <div class="user-detail">
                                    <div class="user-detail-label">DNI:</div>
                                    <div class="user-detail-value">${user.dni}</div>
                                </div>
                                <div class="user-detail">
                                    <div class="user-detail-label">Usuario:</div>
                                    <div class="user-detail-value">${user.username}</div>
                                </div>
                                <div class="user-detail">
                                    <div class="user-detail-label">Contrase침a:</div>
                                    <div class="user-detail-value">${user.password}</div>
                                </div>
                                <div class="user-detail">
                                    <div class="user-detail-label">Acceso:</div>
                                    <div class="user-detail-value">${user.role === 'administrativo' || user.role === 'programador' ? 'Chatbot + Chat Masivo' : 'Solo Chat Masivo'}</div>
                                </div>
                            </div>
                            <div class="user-actions">
                                <button class="btn btn-danger" onclick="deleteUser(${user.id})">
                                    <i class="fas fa-trash"></i> Eliminar
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    usersList.innerHTML = `
                        <div class="no-users">
                            <i class="fas fa-users"></i>
                            <p>No hay usuarios registrados</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error al cargar usuarios:', error);
                document.getElementById('users-list').innerHTML = `
                    <div class="no-users">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error al cargar usuarios</p>
                    </div>
                `;
            }
        }
        
        // Eliminar usuario
        async function deleteUser(userId) {
            if (confirm('쮼st치s seguro de que quieres eliminar este usuario?')) {
                try {
                    const response = await fetch(`/api/users/delete/${userId}`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Usuario eliminado exitosamente');
                        loadUsers();
                    } else {
                        alert('Error al eliminar usuario: ' + result.message);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al eliminar usuario');
                }
            }
        }
        
        // Buscar usuarios
        function searchUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const userItems = document.querySelectorAll('.user-item');
            
            userItems.forEach(item => {
                const userName = item.querySelector('.user-name').textContent.toLowerCase();
                const userDni = item.querySelector('.user-detail-value').textContent;
                
                if (userName.includes(searchTerm) || userDni.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Inicializaci칩n
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Chatbot v2.0 - Cargado con funcionalidad de URLs y Base de Datos');
            loadDocuments();
            updateStats();
            loadUserInfo();
            
            
            // Agregar event listener al input de archivo para mostrar el nombre del archivo seleccionado
            const fileInput = document.getElementById('document-file');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        console.log('Archivo seleccionado:', file.name);
                        // Actualizar el texto del bot칩n para mostrar el archivo seleccionado
                        const fileInputWrapper = document.querySelector('.file-input-wrapper');
                        if (fileInputWrapper) {
                            const buttonText = fileInputWrapper.querySelector('span');
                            if (buttonText) {
                                buttonText.innerHTML = `<i class="fas fa-check"></i> ${file.name}`;
                            }
                        }
                    }
                });
            }
            
            // Actualizar estad칤sticas cada minuto
            setInterval(updateStats, 60000);
            
            // Event listeners para gesti칩n de usuarios
            const createUserForm = document.getElementById('create-user-form');
            if (createUserForm) {
                createUserForm.addEventListener('submit', createUser);
            }
            
            // Generar contrase침a autom치ticamente cuando se ingresa el DNI
            const dniInput = document.getElementById('user-dni');
            if (dniInput) {
                dniInput.addEventListener('input', generatePassword);
            }
            
            // Cargar usuarios al mostrar la pesta침a
            const usersTab = document.getElementById('users-tab');
            if (usersTab) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (usersTab.classList.contains('active')) {
                                loadUsers();
                            }
                        }
                    });
                });
                observer.observe(usersTab, { attributes: true });
            }
        });

        // Funci칩n para cargar informaci칩n del usuario
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/auth/check');
                const result = await response.json();
                
                if (result.authenticated) {
                    document.getElementById('userName').textContent = `${result.user.name} ${result.user.lastname}`;
                    document.getElementById('userRole').textContent = result.user.role.toUpperCase();
                } else {
                    // Si no est치 autenticado, redirigir al login
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Error cargando informaci칩n del usuario:', error);
                window.location.href = '/login';
            }
        }

        // Funci칩n para cerrar sesi칩n
        async function logout() {
            try {
                const response = await fetch('/api/auth/logout', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    window.location.href = '/login';
                } else {
                    alert('Error al cerrar sesi칩n: ' + result.message);
                }
            } catch (error) {
                console.error('Error cerrando sesi칩n:', error);
                window.location.href = '/login';
            }
        }

        // Agregar estilos de animaci칩n
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>